<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kais.resultMap.mapper.EmployeeMapper">
    <!--
        resultMap: è‡ªå®šä¹‰ç»“æžœé›†æ˜ å°„è§„åˆ™
            id: å”¯ä¸€æ ‡è¯†, æ–¹ä¾¿è¢«å¼•ç”?
            type: æ˜ å°„åˆ°çš„å®žä½“ç±»çš„å…¨ç±»å?
     -->
    <resultMap id="employee" type="com.kais.resultMap.pojo.Employee">
        <!--
            id: æ˜ å°„å®žä½“ç±»ä¸­ä¸Žä¸»é”®å¯¹åº”çš„å±žæ??
                column: ä¸»é”®åˆ—çš„åˆ—å
                property: ä¸»é”®åˆ—å¯¹åº?(å®žä½“ç±?)çš„å±žæ€?
         -->
        <id property="userId" column="id"/>

        <!-- result: æ˜ å°„æ™®é?šå±žæ€? -->
        <result property="lastName" column="last_name"/>
        <result property="userEmail" column="email"/>
    </resultMap>
    <!--
        å¦‚æžœjavaBenå±žæ?§åå’Œåˆ—åä¸ä¸?è‡?, ä¸åº”è¯¥å†ä½¿ç”¨resultTypeé…ç½®è¿”å›žå€¼ç±»åž?
        è€Œæ˜¯ä½¿ç”¨resultMapå¼•ç”¨è‡ªå®šä¹‰çš„ç»“æžœé›†æ˜ å°„è§„åˆ?
     -->
    <select id="getAll" resultMap="employee">
        select * from employee
    </select>


    <!--resultMapè¿›é˜¶ç”¨æ³•-->
    <!--
åœºæ™¯ä¸?ï¼?
    æŸ¥è¯¢Employeeçš„åŒæ—¶æŸ¥è¯¢å‘˜å·¥å¯¹åº”çš„éƒ¨é—¨
    Employee===Department
    è®¾ç½®ä¸»å¤–é”®å…³è”ï¼šALTER TABLE employee ADD CONSTRAINT fk_emp_dept
          FOREIGN KEY(d_id) REFERENCES department(id)
    ä¸?ä¸ªå‘˜å·¥æœ‰ä¸Žä¹‹å¯¹åº”çš„éƒ¨é—¨ä¿¡æ¯ï¼›
    userId  last_name  gender    d_id     did  dept_name (private Department dept;)
 -->
    <!--
        è”åˆæŸ¥è¯¢ï¼šçº§è”å±žæ€§å°è£…ç»“æžœé›†
      -->
    <resultMap type="com.kais.resultMap.pojo.Employee" id="MyDifEmp">
        <id column="id" property="userId"/>
        <result column="last_name" property="lastName"/>
        <result column="gender" property="gender"/>
        <result column="d_id" property="dept.id"/>
        <result column="department_name" property="dept.departmentName"/>
    </resultMap>
    <!--  public Employee getEmpAndDept(Integer id);-->
    <select id="getEmpAndDept" resultMap="MyDifEmp">
		SELECT e.id id,e.last_name last_name,e.gender gender,e.d_id d_id,
		d.id id,d.department_name department_name FROM employee e,department d
		WHERE e.d_id=d.id AND e.id=#{id}
	</select>



    <!--ä½¿ç”¨associationå®šä¹‰å…³è”çš„å•ä¸ªå¯¹è±¡çš„å°è£…è§„åˆ™ï¼?-->
    <!--  id  last_name  email   gender    d_id   -->
    <resultMap type="com.kais.resultMap.pojo.Employee" id="MyDifEmp2">
        <id column="id" property="userId"/>
        <result column="last_name" property="lastName"/>
        <result column="gender" property="gender"/>
        <!-- associationå¯ä»¥æŒ‡å®šè”åˆçš„javaBeanå¯¹è±¡
		property="dept"ï¼šæŒ‡å®šå“ªä¸ªå±žæ€§æ˜¯è”åˆçš„å¯¹è±?
		javaType:æŒ‡å®šè¿™ä¸ªå±žæ?§å¯¹è±¡çš„ç±»åž‹[ä¸èƒ½çœç•¥]
         -->
        <association property="dept" javaType="com.kais.resultMap.pojo.Department">
            <id column="did" property="id"/>
            <result column="department_name" property="departmentName"/>
        </association>
    </resultMap>



    <!-- ä½¿ç”¨associationè¿›è¡Œåˆ†æ­¥æŸ¥è¯¢ï¼?
		1ã€å…ˆæŒ‰ç…§å‘˜å·¥idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯
		2ã€æ ¹æ®æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ä¸­çš„d_idå€¼åŽ»éƒ¨é—¨è¡¨æŸ¥å‡ºéƒ¨é—¨ä¿¡æ?
		3ã€éƒ¨é—¨è®¾ç½®åˆ°å‘˜å·¥ä¸­ï¼›
	 -->
    <resultMap id="MyEmpByStep" type="com.kais.resultMap.pojo.Employee">
        <id column="id" property="userId"/>
        <result column="last_name" property="lastName"/>
        <result column="email" property="userEmail"/>
        <result column="gender" property="gender"/>
        <!-- associationå®šä¹‰å…³è”å¯¹è±¡çš„å°è£…è§„åˆ?
            select:è¡¨æ˜Žå½“å‰å±žæ?§æ˜¯è°ƒç”¨selectæŒ‡å®šçš„æ–¹æ³•æŸ¥å‡ºçš„ç»“æžœ
            column:æŒ‡å®šå°†å“ªä¸?åˆ—çš„å€¼ä¼ ç»™è¿™ä¸ªæ–¹æ³?
    æµç¨‹ï¼šä½¿ç”¨selectæŒ‡å®šçš„æ–¹æ³•ï¼ˆä¼ å…¥columnæŒ‡å®šçš„è¿™åˆ—å‚æ•°çš„å€¼ï¼‰æŸ¥å‡ºå¯¹è±¡ï¼Œå¹¶å°è£…ç»™propertyæŒ‡å®šçš„å±žæ€?
 -->
        <association property="dept"
                     select="com.kais.resultMap.mapper.DepartmentMapper.getDeptById"
                     column="d_id">
        </association>
    </resultMap>
    <select id="getEmpByIdStep" resultMap="MyEmpDis">
        select * from employee where id = #{id}
    </select>
    <!-- å¯ä»¥ä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰ï¼›(æŒ‰éœ€åŠ è½½)
    Employee==>Deptï¼?
        æˆ‘ä»¬æ¯æ¬¡æŸ¥è¯¢Employeeå¯¹è±¡çš„æ—¶å€™ï¼Œéƒ½å°†ä¸?èµ·æŸ¥è¯¢å‡ºæ¥ã??
        éƒ¨é—¨ä¿¡æ¯åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å?™å†åŽ»æŸ¥è¯¢ï¼›
        åˆ†æ®µæŸ¥è¯¢çš„åŸºç¡?ä¹‹ä¸ŠåŠ ä¸Šä¸¤ä¸ªé…ç½®ï¼?
 -->
    <!-- ==================association============================ -->


    <!--
	åœºæ™¯äºŒï¼š
		æŸ¥è¯¢éƒ¨é—¨çš„æ—¶å€™å°†éƒ¨é—¨å¯¹åº”çš„æ‰€æœ‰å‘˜å·¥ä¿¡æ¯ä¹ŸæŸ¥è¯¢å‡ºæ¥ï¼šæ³¨é‡Šåœ¨DepartmentMapper.xmlä¸?
	 -->
    <!-- public List<Employee> getEmpsByDeptId(Integer deptId); -->
    <select id="getEmpsByDeptId" resultType="com.kais.resultMap.pojo.Employee">
		select * from tbl_employee where d_id=#{deptId}
	</select>


    <!-- =======================é‰´åˆ«å™?============================ -->
    <!-- <discriminator javaType=""></discriminator>
        é‰´åˆ«å™¨ï¼šmybatiså¯ä»¥ä½¿ç”¨discriminatoråˆ¤æ–­æŸåˆ—çš„å?¼ï¼Œç„¶åŽæ ¹æ®æŸåˆ—çš„å?¼æ”¹å˜å°è£…è¡Œä¸?
        å°è£…Employeeï¼?
            å¦‚æžœæŸ¥å‡ºçš„æ˜¯å¥³ç”Ÿï¼šå°±æŠŠéƒ¨é—¨ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œå¦åˆ™ä¸æŸ¥è¯¢ï¼›
            å¦‚æžœæ˜¯ç”·ç”Ÿï¼ŒæŠŠlast_nameè¿™ä¸€åˆ—çš„å€¼èµ‹å€¼ç»™email;
     -->

    <resultMap type="com.kais.resultMap.pojo.Employee" id="MyEmpDis">
        <id column="id" property="userId"/>
        <result column="last_name" property="lastName"/>
        <result column="email" property="userEmail"/>
        <result column="gender" property="gender"/>
        <!--
            columnï¼šæŒ‡å®šåˆ¤å®šçš„åˆ—å
            javaTypeï¼šåˆ—å€¼å¯¹åº”çš„javaç±»åž‹  -->
        <discriminator javaType="string" column="gender">
            <!--å¥³ç”Ÿ  resultType:æŒ‡å®šå°è£…çš„ç»“æžœç±»åž‹ï¼›ä¸èƒ½ç¼ºå°‘ã€?/resultMap-->
            <case value="0" resultType="com.kais.resultMap.pojo.Employee">
                <association property="dept"
                             select="com.kais.resultMap.mapper.DepartmentMapper.getDeptById"
                             column="d_id">
                </association>
            </case>
            <!--ç”·ç”Ÿ ;å¦‚æžœæ˜¯ç”·ç”Ÿï¼ŒæŠŠlast_nameè¿™ä¸€åˆ—çš„å€¼èµ‹å€¼ç»™email; -->
            <case value="1" resultType="com.kais.resultMap.pojo.Employee">
                <id column="id" property="userId"/>
                <result column="last_name" property="lastName"/>
                <result column="last_name" property="userEmail"/>
                <result column="gender" property="gender"/>
            </case>
        </discriminator>
    </resultMap>



</mapper>