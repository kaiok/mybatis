<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kais.mapper.BlogMapper">

    <!-- if -->
    <select id="getByBlogIf" resultType="com.kais.pojo.Blog">
        select * from blog where
        <!-- test: åˆ¤æ–­çš„è¡¨è¾¾å¼ (OGNL)-->
        <if test="title != null and title.trim() != ''">
            title like #{title}
        </if>
        <if test="author != null and author.trim() != ''">
            and author like #{author}
        </if>
    </select>

    <!-- where -->
    <select id="getByBlogWhere" resultType="com.kais.pojo.Blog">
        select * from blog
        <where>
            <if test="title != null and title.trim() != ''">
                and title like #{title}
            </if>
            <if test="author != null and author.trim() != ''">
                and author like #{author}
            </if>
        </where>
    </select>

    <!--bind-->
    <select id="getByBlogBind" resultType="com.kais.pojo.Blog">
        select * from blog
        <where>
            <if test="title != null and title.trim() != ''">
                <!-- bind -->
                <bind name="newTitle" value="'%' + title + '%'"/>
                and title like #{newTitle}
            </if>
            <if test="author != null and author.trim() != ''">
                <bind name="newAuthor" value="'%' + author + '%'"/>
                and author like #{newAuthor}
            </if>
        </where>
    </select>

    <!-- set -->
    <update id="update">
        update blog
        <set>
            <if test="title != null and title.trim() != ''">
                , title = #{title}
            </if>
            <if test="author != null and author.trim() != ''">
                , author = #{author}
            </if>
            <if test="createTime != null">
                , create_time = #{createTime}
            </if>
            <if test="views != null and views > 100">
                , views = #{views}
            </if>
        </set>
        where id = #{id}
    </update>

    <!--choose-->
    <select id="getByBlogChoose" resultType="com.kais.pojo.Blog">
        select * from blog
        <where>
            <choose>
                <when test="id != null and id > 0">
                    and id = #{id}
                </when>
                <when test="title != null and title.trim() != ''">
                    <bind name="title" value="'%' + title + '%'"/>
                    and title like #{title}
                </when>
                <otherwise>
                    and author = 'kais'
                </otherwise>
            </choose>
        </where>
    </select>


    <select id="getByIds" resultType="com.kais.pojo.Blog">
        select * from blog
        <where>
            <if test="list != null and list.size() > 0">
                <!--
                    collection: æŒ‡å®šéåŽ†çš„é›†å?; åªèƒ½å†™ä¸Žé›†åˆç±»åž‹å¯¹åº”çš„åå­?,å¦‚æžœæƒ³ä½¿ç”¨å…¶ä»–åç§°åˆ™å¿…é¡»ä½¿ç”¨@paramæ³¨è§£æŒ‡å®šåç§°
                    item: å°†å½“å‰éåŽ†çš„å…ƒç´ èµ‹å?¼ç»™æŒ‡å®šçš„å˜é‡?
                    separator: å…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦
                    open: æŒ‡å®šå¼?å§‹ç¬¦å?
                    close: æŒ‡å®šç»“æŸç¬¦å·
                    index: éåŽ†Listçš„æ—¶å€™æ˜¯indexç´¢å¼•, itemæ˜¯å½“å‰å??
                           éåŽ†Mapçš„æ—¶å€™indexæ˜¯mapçš„key, itemæ˜¯mapçš„å??
                -->
                <foreach collection="collection" item="id" open="and id in(" separator="," close=")">
                    #{id}
                </foreach>
            </if>
        </where>
    </select>


    <!--
        sql: æŠ½å–ç‰‡æ®µ
        id: å”¯ä¸€æ ‡è¯†
     -->
    <sql id="column">
        id, title, author, create_time, views
    </sql>
    <select id="getAll" resultType="com.kais.pojo.Blog">
        <!--
            include: å¼•å…¥sqlèŠ‚ç‚¹å®šä¹‰çš„sqlç‰‡æ®µ
            refid: å¼•ç”¨æŒ‡å®šidçš„sqlç‰‡æ®µ
         -->
        select <include refid="column"/> from blog
    </select>

</mapper>